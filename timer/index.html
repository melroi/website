<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrono Muscu Ultra</title>
    <style>
        :root { --primary: #e74c3c; --secondary: #2c3e50; --bg: #121212; --text: #ffffff; --green: #27ae60; }
        body { font-family: 'Arial', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; }
        
        #timer-display { font-size: 5rem; font-weight: bold; margin: 10px 0; color: var(--primary); text-shadow: 0 0 20px rgba(231, 76, 60, 0.3); }
        #status-label { font-size: 1.5rem; color: var(--green); height: 30px; margin-bottom: 10px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); gap: 8px; width: 100%; max-width: 500px; margin-bottom: 15px; }
        
        button { padding: 18px 5px; font-size: 1rem; border: none; border-radius: 10px; background: var(--secondary); color: white; cursor: pointer; font-weight: bold; }
        button:active { transform: scale(0.92); }
        
        .main-controls { grid-template-columns: 1fr 1fr 1fr; }
        .btn-start { background: var(--green); }
        .btn-stop { background: var(--primary); }
        .btn-replay { background: #f39c12; }
        
        .section { width: 100%; max-width: 500px; border-top: 1px solid #333; padding-top: 15px; margin-top: 10px; }
        h3 { margin: 0 0 10px 0; font-size: 1rem; color: #888; text-transform: uppercase; }

        .flex-row { display: flex; gap: 10px; margin-bottom: 10px; }
        select, input { flex: 1; padding: 12px; border-radius: 8px; border: none; background: #333; color: white; }

        .plank-mode { background: #1e272e; padding: 15px; border-radius: 12px; border: 2px solid #34495e; }
    </style>
</head>
<body>

    <div id="status-label">PRÊT</div>
    <div id="timer-display">00:00</div>

    <div class="grid main-controls">
        <button class="btn-start" onclick="startTimer()">START</button>
        <button class="btn-stop" onclick="stopTimer()">STOP</button>
        <button class="btn-replay" onclick="replayTimer()">RE-LANCER</button>
    </div>

    <div class="section">
        <h3>Minutes & Heures</h3>
        <div class="grid">
            <button onclick="setTime(1)">1m</button>
            <button onclick="setTime(2)">2m</button>
            <button onclick="setTime(3)">3m</button>
            <button onclick="setTime(5)">5m</button>
            <button onclick="setTime(10)">10m</button>
            <button onclick="setTime(30)">30m</button>
            <button onclick="setTime(60)">1h</button>
            <button style="background:#444" onclick="addSeconds(30)">+30s</button>
        </div>
    </div>

    <div class="section plank-mode">
        <h3>Mode Planche (Intervalle)</h3>
        <div class="flex-row">
            <input type="number" id="pWork" placeholder="Travail(s)" value="45">
            <input type="number" id="pRest" placeholder="Repos(s)" value="15">
            <input type="number" id="pReps" placeholder="Séries" value="3">
        </div>
        <button onclick="startPlank()" style="width:100%; background: #8e44ad;">LANCER SÉRIE PLANCHE</button>
    </div>

    <div class="section">
        <h3>Métronome Custom</h3>
        <div class="flex-row">
            <input type="number" id="metroVal" placeholder="Secondes (ex: 2.5)" step="0.5">
            <button onclick="toggleMetronome(document.getElementById('metroVal').value)" style="background:var(--green)">ON</button>
            <button onclick="toggleMetronome(0)" style="background:var(--primary)">OFF</button>
        </div>
    </div>

    <audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
    <audio id="longBeep" src="https://actions.google.com/sounds/v1/alarms/alarm_clock_short_sig_9.ogg"></audio>

    <script>
        let countdown;
        let timeLeft = 0;
        let lastTimeSet = 0;
        let metroInterval;
        let isPlank = false;

        const display = document.getElementById('timer-display');
        const status = document.getElementById('status-label');
        const beep = document.getElementById('beep');
        const longBeep = document.getElementById('longBeep');

        function updateDisplay() {
            let m = Math.floor(timeLeft / 60);
            let s = timeLeft % 60;
            display.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function setTime(m) {
            stopTimer();
            timeLeft = m * 60;
            lastTimeSet = timeLeft;
            status.innerText = "TEMPS PRÊT";
            updateDisplay();
        }

        function addSeconds(s) {
            timeLeft += s;
            lastTimeSet = timeLeft;
            updateDisplay();
        }

        function replayTimer() {
            stopTimer();
            timeLeft = lastTimeSet;
            updateDisplay();
            startTimer();
        }

        function startTimer() {
            clearInterval(countdown);
            if(timeLeft <= 0) return;
            status.innerText = "TRAVAIL !";
            countdown = setInterval(() => {
                timeLeft--;
                updateDisplay();
                if(timeLeft <= 0) {
                    clearInterval(countdown);
                    longBeep.play();
                    status.innerText = "TERMINÉ !";
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(countdown);
            isPlank = false;
            status.innerText = "PAUSE / STOP";
        }

        function toggleMetronome(seconds) {
            clearInterval(metroInterval);
            if (seconds <= 0 || !seconds) return;
            status.innerText = `MÉTRONOME : ${seconds}s`;
            metroInterval = setInterval(() => {
                beep.play();
            }, seconds * 1000);
        }

        async function startPlank() {
            stopTimer();
            const work = parseInt(document.getElementById('pWork').value);
            const rest = parseInt(document.getElementById('pRest').value);
            const sets = parseInt(document.getElementById('pReps').value);
            
            for(let i = 1; i <= sets; i++) {
                // Phase Travail
                status.innerText = `SÉRIE ${i} : ACTION !`;
                status.style.color = "var(--green)";
                timeLeft = work;
                await runPlankSegment();
                
                if(i < sets) {
                    // Phase Repos
                    longBeep.play();
                    status.innerText = `REPOS...`;
                    status.style.color = "var(--primary)";
                    timeLeft = rest;
                    await runPlankSegment();
                    longBeep.play();
                }
            }
            status.innerText = "SESSION PLANCHE FINIE !";
            status.style.color = "white";
        }

        function runPlankSegment() {
            return new Promise(resolve => {
                updateDisplay();
                countdown = setInterval(() => {
                    timeLeft--;
                    updateDisplay();
                    if(timeLeft <= 0) {
                        clearInterval(countdown);
                        resolve();
                    }
                }, 1000);
            });
        }
    </script>
</body>
</html>