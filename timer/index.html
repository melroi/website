<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chrono Muscu Ultimate</title>
    <style>
        :root {
            --bg: #121212; --card: #1e1e1e; --text: #ffffff;
            --primary: #e74c3c; --secondary: #3498db; --green: #27ae60;
        }
        .light-mode {
            --bg: #f0f0f0; --card: #ffffff; --text: #121212;
            --primary: #c0392b; --secondary: #2980b9; --green: #219150;
        }
        body {
            font-family: sans-serif; background: var(--bg); color: var(--text);
            margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center;
        }
        .header { width: 100%; max-width: 600px; display: flex; justify-content: space-between; margin-bottom: 10px; }
        #timer-display { font-size: clamp(4rem, 15vw, 6rem); font-weight: 800; margin: 5px 0; color: var(--primary); }
        .container { width: 100%; max-width: 600px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; margin-bottom: 15px; }
        button { 
            padding: 15px 5px; border: none; border-radius: 12px; 
            background: var(--card); color: var(--text); cursor: pointer; font-weight: bold;
        }
        .btn-main { background: var(--green); color: white; }
        .btn-stop { background: var(--primary); color: white; }
        .section { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; }
        h3 { margin-top: 0; font-size: 0.8rem; text-transform: uppercase; opacity: 0.6; }
        .todo-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .todo-row input[type="checkbox"] { width: 22px; height: 22px; }
        .todo-row input[type="text"] { flex: 1; padding: 8px; border-radius: 5px; border: none; background: rgba(128,128,128,0.1); color: var(--text); }
        select, .control-btn { background: #333; color: white; padding: 10px; border-radius: 8px; border: none; width: 100%; }
        .active-opt { border: 2px solid var(--green) !important; background: #2c3e50; }
        #confirm-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center;
        }
    </style>
</head>
<body>

    <div class="header">
        <button onclick="toggleTheme()">‚òÄÔ∏è/üåô</button>
        <button style="background:var(--primary); color:white" onclick="showResetConfirm()">RESET</button>
    </div>

    <div id="timer-display">00:00</div>

    <div class="container">
        <div class="grid" style="grid-template-columns: 1fr 1fr 1fr;">
            <button class="btn-main" onclick="startTimer()">START</button>
            <button class="btn-stop" onclick="stopTimer()">STOP</button>
            <button style="background: #f39c12; color:white" onclick="replayTimer()">REPLAY</button>
        </div>

        <div class="section">
            <h3>Param√®tres Alertes</h3>
            <div class="grid" style="grid-template-columns: 1fr 1fr;">
                <button id="btn-sound" onclick="toggleSound()">SON: ON</button>
                <button id="btn-vibrate" onclick="toggleVibrate()">VIBREUR: ON</button>
            </div>
            <select id="soundSelect" onchange="changeSound()">
                <option value="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">Son : Bip Court</option>
                <option value="https://actions.google.com/sounds/v1/alarms/alarm_clock_short_sig_9.ogg">Son : Alarme</option>
                <option value="https://actions.google.com/sounds/v1/alarms/dinner_bell.ogg">Son : Cloche</option>
            </select>
        </div>

        <div class="section">
            <div class="grid">
                <button onclick="setTime(1)">1m</button>
                <button onclick="setTime(2)">2m</button>
                <button onclick="setTime(3)">3m</button>
                <button onclick="addSeconds(30)">+30s</button>
                <button onclick="addSeconds(10)">+10s</button>
            </div>
        </div>

        <div class="section">
            <h3>Exercices</h3>
            <div id="todo-list"></div>
            <button onclick="addTodoRow()" style="width:100%; margin-top:10px; background:var(--secondary); color:white">+ Ajouter</button>
        </div>
    </div>

    <div id="confirm-overlay">
        <div style="background:var(--card); padding:20px; border-radius:15px; text-align:center;">
            <p>Tout effacer ?</p>
            <button onclick="resetEverything()" style="background:var(--primary); color:white; margin-right:10px; padding:10px 20px;">OUI</button>
            <button onclick="hideResetConfirm()" style="background:var(--secondary); color:white; padding:10px 20px;">NON</button>
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        let countdown, timeLeft = 0, lastTimeSet = 0;
        let soundEnabled = true, vibrateEnabled = true;
        const player = document.getElementById('audioPlayer');

        // --- GESTION SON ET VIBREUR ---
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('btn-sound').innerText = `SON: ${soundEnabled ? 'ON' : 'OFF'}`;
            if(soundEnabled) { player.src = document.getElementById('soundSelect').value; player.play(); }
        }

        function toggleVibrate() {
            vibrateEnabled = !vibrateEnabled;
            document.getElementById('btn-vibrate').innerText = `VIBREUR: ${vibrateEnabled ? 'ON' : 'OFF'}`;
            if(vibrateEnabled && "vibrate" in navigator) { navigator.vibrate(200); }
        }

        function changeSound() {
            player.src = document.getElementById('soundSelect').value;
            if(soundEnabled) player.play();
        }

        // --- TIMER ---
        function updateDisplay() {
            let m = Math.floor(timeLeft / 60);
            let s = timeLeft % 60;
            document.getElementById('timer-display').innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function setTime(m) { stopTimer(); timeLeft = m * 60; lastTimeSet = timeLeft; updateDisplay(); }
        function addSeconds(s) { timeLeft += s; lastTimeSet = timeLeft; updateDisplay(); }
        function replayTimer() { stopTimer(); timeLeft = lastTimeSet; startTimer(); }

        function startTimer() {
            clearInterval(countdown);
            if(timeLeft <= 0) return;
            countdown = setInterval(() => {
                timeLeft--;
                updateDisplay();
                if(timeLeft <= 0) {
                    clearInterval(countdown);
                    if(soundEnabled) { player.src = document.getElementById('soundSelect').value; player.play(); }
                    if(vibrateEnabled && "vibrate" in navigator) { navigator.vibrate([500, 200, 500]); }
                }
            }, 1000);
        }

        function stopTimer() { clearInterval(countdown); }

        // --- THEME & TODOS ---
        function toggleTheme() { document.body.classList.toggle('light-mode'); }
        
        function addTodoRow(text = "", checked = false) {
            const div = document.createElement('div');
            div.className = 'todo-row';
            div.innerHTML = `<input type="checkbox" ${checked ? 'checked' : ''} onchange="saveTodos()">
                             <input type="text" value="${text}" placeholder="Exercice..." oninput="saveTodos()">
                             <button onclick="this.parentElement.remove(); saveTodos()" style="background:none; color:red;">‚úï</button>`;
            document.getElementById('todo-list').appendChild(div);
            saveTodos();
        }

        function saveTodos() {
            const data = Array.from(document.querySelectorAll('.todo-row')).map(r => ({
                text: r.querySelector('input[type="text"]').value,
                checked: r.querySelector('input[type="checkbox"]').checked
            }));
            localStorage.setItem('muscu_data', JSON.stringify(data));
        }

        function loadTodos() {
            const data = JSON.parse(localStorage.getItem('muscu_data') || '[]');
            if(data.length === 0) addTodoRow("Exemple : Pompes");
            else data.forEach(d => addTodoRow(d.text, d.checked));
        }

        function showResetConfirm() { document.getElementById('confirm-overlay').style.display = 'flex'; }
        function hideResetConfirm() { document.getElementById('confirm-overlay').style.display = 'none'; }
        function resetEverything() { localStorage.clear(); location.reload(); }

        window.onload = loadTodos;
    </script>
</body>
</html>