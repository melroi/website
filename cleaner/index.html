<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Nettoyeur de texte</title>
</head>
<body>
  <div class="container">
    <h1>Nettoyeur de Texte</h1>
    
    <div class="input-group">
      <label for="input">Texte √† nettoyer</label>
      <textarea id="input" placeholder="Collez votre texte brut ici..."></textarea>
    </div>

    <div class="options-panel">
      <div class="options-title">Options de nettoyage</div>
      <div class="checkbox-grid">
        <div class="checkbox-item">
          <input type="checkbox" class="char-option" value="#" id="hash" checked>
          <label for="hash"># (hashtags)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" class="char-option" value="-" id="dash">
          <label for="dash">- (tirets simples)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="triple-dash" checked>
          <label for="triple-dash">--- (groupes de 3+)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" class="char-option" value="`" id="backtick" checked>
          <label for="backtick">` (backticks)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" class="char-option" value="*" id="asterisk" checked>
          <label for="asterisk">* (ast√©risques)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" class="char-option" value="@" id="at">
          <label for="at">@ (arobase)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" class="char-option" value="$" id="dollar">
          <label for="dollar">$ (dollar)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="remove-emojis" checked>
          <label for="remove-emojis">Supprimer les emojis</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="remove-invisible" checked>
          <label for="remove-invisible">Supprimer les watermarks IA et caract√®res invisibles</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="smart-dashes" checked>
          <label for="smart-dashes">Gestion intelligente des tirets</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="show-stats" checked>
          <label for="show-stats">Afficher les statistiques</label>
        </div>
      </div>
    </div>

    <div id="stats-panel" style="display: none;">
      <h3>Statistiques de nettoyage</h3>
      <div id="stats-content"></div>
    </div>

    <div class="output-section">
      <div class="input-group">
        <label for="output">Texte nettoy√©</label>
        <textarea id="output" readonly></textarea>
      </div>
    </div>

    <button id="copy">Copier le texte nettoy√©</button>
  </div>

  <div id="notification" style="display: none;">Texte copi√© dans le presse-papiers !</div>

  <script>
    const input = document.getElementById('input');
    const output = document.getElementById('output');
    const checkboxes = document.querySelectorAll('.char-option');
    const tripleDash = document.getElementById('triple-dash');
    const copyBtn = document.getElementById('copy');
    const notification = document.getElementById('notification');

    function updateOutput() {
      let text = input.value;
      const stats = {
        invisible: 0,
        zeroWidth: 0,
        watermarks: 0,
        emDashes: 0
      };

      const smartDashes = document.getElementById('smart-dashes');
      if (smartDashes.checked) {
        // Remplace les tirets longs par des tirets simples
        const emDashCount = (text.match(/[\u2014\u2015]/g) || []).length;
        text = text.replace(/[\u2014\u2015]/g, '-');
        stats.emDashes = emDashCount;
      }

      if (tripleDash.checked) {
        text = text.replace(/-{3,}/g, '');
      }

      const selectedChars = Array.from(checkboxes)
        .filter(cb => cb.checked)
        .map(cb => cb.value)
        .join('');

      if (selectedChars.length > 0) {
        const escapedChars = selectedChars.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&');
        const regex = new RegExp(`[${escapedChars}]`, 'g');
        text = text.replace(regex, '');
      }

      const removeEmojis = document.getElementById('remove-emojis');
      if (removeEmojis.checked) {
        text = text.replace(/[\p{Extended_Pictographic}]/gu, '');
      }

      const removeInvisible = document.getElementById('remove-invisible');
      if (removeInvisible.checked) {
        // Compte et supprime les caract√®res invisibles
        const invisibleCount = (text.match(/[\u0000-\u001F\u007F-\u009F]/g) || []).length;
        text = text.replace(/[\u0000-\u001F\u007F-\u009F]/g, '');
        stats.invisible = invisibleCount;

        // Compte et supprime les caract√®res zero-width
        const zeroWidthCount = (text.match(/[\u200B\u200C\u200D\u200E\u200F\uFEFF]/g) || []).length;
        text = text.replace(/[\u200B\u200C\u200D\u200E\u200F\uFEFF]/g, '');
        stats.zeroWidth = zeroWidthCount;

        // Compte et supprime les watermarks
        const watermarkCount = (text.match(/[\u202A-\u202E]/g) || []).length;
        text = text.replace(/[\u202A-\u202E]/g, '');
        stats.watermarks = watermarkCount;

        // Normalise les espaces
        text = text.replace(/[\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/g, ' ');
        text = text.replace(/\s+/g, ' ');
      }

      output.value = text;
      updateStats(stats);
    }

    function updateStats(stats) {
      const showStats = document.getElementById('show-stats');
      const statsPanel = document.getElementById('stats-panel');
      const statsContent = document.getElementById('stats-content');

      if (showStats.checked && (stats.invisible > 0 || stats.zeroWidth > 0 || stats.watermarks > 0 || stats.emDashes > 0)) {
        statsPanel.style.display = 'block';
        statsContent.innerHTML = `
          ${stats.invisible > 0 ? `<p>üìç ${stats.invisible} caract√®res invisibles supprim√©s</p>` : ''}
          ${stats.zeroWidth > 0 ? `<p>üîç ${stats.zeroWidth} espaces de largeur nulle supprim√©s</p>` : ''}
          ${stats.watermarks > 0 ? `<p>üè∑Ô∏è ${stats.watermarks} watermarks supprim√©s</p>` : ''}
          ${stats.emDashes > 0 ? `<p>‚ûñ ${stats.emDashes} tirets longs convertis</p>` : ''}
        `;
      } else {
        statsPanel.style.display = 'none';
      }
    }

    function showNotification() {
      notification.style.display = 'block';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 2000);
    }

    input.addEventListener('input', updateOutput);
    checkboxes.forEach(cb => cb.addEventListener('change', updateOutput));
    tripleDash.addEventListener('change', updateOutput);

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(output.value);
        showNotification();
      } catch (err) {
        output.select();
        document.execCommand('copy');
        showNotification();
      }
    });

    document.getElementById('show-stats').addEventListener('change', updateOutput);
    document.getElementById('smart-dashes').addEventListener('change', updateOutput);

    updateOutput();
  </script>
</body>
</html>