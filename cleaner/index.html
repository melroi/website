<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nettoyeur de texte avancé</title>
<style>
  body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
  textarea { width: 100%; min-height: 100px; margin-bottom: 10px; padding: 10px; font-size: 1rem; white-space: pre-wrap; }
  .checkbox-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 15px;
  }
  .checkbox-item { display: flex; align-items: center; gap: 5px; }
  button { padding: 10px 15px; font-size: 1rem; cursor: pointer; margin: 5px 5px 10px 0; }
</style>
</head>
<body>

<h1>Nettoyeur de texte avancé</h1>

<label for="input">Texte à nettoyer :</label>
<textarea id="input" placeholder="Collez votre texte ici..."></textarea>

<button id="paste">📋 Coller le texte</button>

<h3>Options de nettoyage :</h3>
<div class="checkbox-grid">
  <div class="checkbox-item"><input type="checkbox" class="char-option" value="#" id="hash" checked> <label for="hash"># (hashtags)</label></div>
  <div class="checkbox-item"><input type="checkbox" class="char-option" value="-" id="dash" checked> <label for="dash">- (tirets)</label></div>
  <div class="checkbox-item"><input type="checkbox" class="char-option" value="`" id="backtick" checked> <label for="backtick">` (backticks)</label></div>
  <div class="checkbox-item"><input type="checkbox" class="char-option" value="*" id="asterisk" checked> <label for="asterisk">* (astérisques)</label></div>
  <div class="checkbox-item"><input type="checkbox" class="char-option" value="@" id="at"> <label for="at">@ (arobase)</label></div>
  <div class="checkbox-item"><input type="checkbox" class="char-option" value="$" id="dollar"> <label for="dollar">$ (dollar)</label></div>
  <div class="checkbox-item"><input type="checkbox" id="remove-emojis" checked> <label for="remove-emojis">Supprimer les emojis</label></div>
  <div class="checkbox-item"><input type="checkbox" id="triple-dash" checked> <label for="triple-dash">Supprimer 3+ tirets / em-dashes</label></div>
  <div class="checkbox-item"><input type="checkbox" id="remove-invisible" checked> <label for="remove-invisible">Supprimer caractères invisibles</label></div>
  <div class="checkbox-item"><input type="checkbox" id="remove-cite" checked> <label for="remove-cite">Supprimer [cite:...] et [cite_start]</label></div>
  <div class="checkbox-item"><input type="checkbox" id="remove-num-ref" checked> <label for="remove-num-ref">Supprimer références numériques [3][4][5]</label></div>
  <div class="checkbox-item"><input type="checkbox" id="remove-superscript" checked> <label for="remove-superscript">Supprimer exposants ¹²³…</label></div>
</div>

<button id="clean">Nettoyer le texte</button>
<button id="highlight">Surligner ce qui serait supprimé</button>
<button id="copy">📋 Copier le texte nettoyé</button>

<h3>Texte nettoyé :</h3>
<textarea id="output" readonly></textarea>

<script>
const input = document.getElementById('input');
const output = document.getElementById('output');
const copyBtn = document.getElementById('copy');
const pasteBtn = document.getElementById('paste');

const checkboxes = {
  chars: document.querySelectorAll('.char-option'),
  emojis: document.getElementById('remove-emojis'),
  tripleDash: document.getElementById('triple-dash'),
  invisible: document.getElementById('remove-invisible'),
  cite: document.getElementById('remove-cite'),
  numRef: document.getElementById('remove-num-ref'),
  superscript: document.getElementById('remove-superscript')
};

function cleanText(text) {
  if(checkboxes.tripleDash.checked){
    text = text.replace(/-{3,}/g,'').replace(/—/g,'');
  }
  const selectedChars = Array.from(checkboxes.chars).filter(cb=>cb.checked).map(cb=>cb.value).join('');
  if(selectedChars.length>0){
    const escaped = selectedChars.replace(/[-/\\^$*+?.()|[\]{}]/g,'\\$&');
    text = text.replace(new RegExp(`[${escaped}]`,'g'),'');
  }
  if(checkboxes.emojis.checked){
    text = text.replace(/[\p{Extended_Pictographic}]/gu,'');
  }
  if(checkboxes.invisible.checked){
    text = text.replace(/[\u200B-\u200F\u202A-\u202E\u2060-\u206F\uFEFF]/g,'');
  }
  if(checkboxes.cite.checked){
    text = text.replace(/\[cite:[^\]]*\]/g,'').replace(/\[cite_start\]/g,'');
  }
  if(checkboxes.numRef.checked){
    text = text.replace(/(\[\d+\])+/g,'');
  }
  if(checkboxes.superscript.checked){
    text = text.replace(/[¹²³⁴⁵⁶⁷⁸⁹⁰]/g,'');
  }
  return text;
}

function highlightText(text){
  let highlighted = text;
  if(checkboxes.tripleDash.checked){
    highlighted = highlighted.replace(/-{3,}/g,m=>`[${m}]`).replace(/—/g,m=>`[${m}]`);
  }
  const selectedChars = Array.from(checkboxes.chars).filter(cb=>cb.checked).map(cb=>cb.value).join('');
  if(selectedChars.length>0){
    const escaped = selectedChars.replace(/[-/\\^$*+?.()|[\]{}]/g,'\\$&');
    highlighted = highlighted.replace(new RegExp(`[${escaped}]`,'g'),m=>`[${m}]`);
  }
  if(checkboxes.emojis.checked){
    highlighted = highlighted.replace(/[\p{Extended_Pictographic}]/gu,m=>`[${m}]`);
  }
  if(checkboxes.invisible.checked){
    highlighted = highlighted.replace(/[\u200B-\u200F\u202A-\u202E\u2060-\u206F\uFEFF]/g,m=>`[${m}]`);
  }
  if(checkboxes.cite.checked){
    highlighted = highlighted.replace(/\[cite:[^\]]*\]/g,m=>`[${m}]`);
    highlighted = highlighted.replace(/\[cite_start\]/g,m=>`[${m}]`);
  }
  if(checkboxes.numRef.checked){
    highlighted = highlighted.replace(/(\[\d+\])+/g,m=>`[${m}]`);
  }
  if(checkboxes.superscript.checked){
    highlighted = highlighted.replace(/[¹²³⁴⁵⁶⁷⁸⁹⁰]/g,m=>`[${m}]`);
  }
  return highlighted;
}

// Événements
document.getElementById('clean').addEventListener('click',()=>{output.value = cleanText(input.value);});
document.getElementById('highlight').addEventListener('click',()=>{output.value = highlightText(input.value);});

copyBtn.addEventListener('click', async ()=>{
  await navigator.clipboard.writeText(output.value);
});

pasteBtn.addEventListener('click', async ()=>{
  const text = await navigator.clipboard.readText();
  input.value = text;
});
</script>

</body>
</html>
